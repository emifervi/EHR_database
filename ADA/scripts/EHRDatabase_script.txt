BEGIN;

CREATE TABLE patient (
 	patient_id INT,
 	first_name VARCHAR(20) NOT NULL,
 	last_name VARCHAR(20) NOT NULL,
 	sex CHAR(1) NOT NULL,
 	rfc VARCHAR (13) NULL,
	phone VARCHAR(15) NOT NULL,
 	city VARCHAR(20) NOT NULL,
  	street_address VARCHAR(50) NOT NULL, 
 	email VARCHAR(30) NOT NULL,
 	date_of_birth DATE NOT NULL,
 	PRIMARY KEY(patient_id)
);

CREATE TABLE doctor (
	 doctor_id INT,
 	 license VARCHAR(8) NOT NULL,
 	 first_name VARCHAR (20) NOT NULL,
	 last_name VARCHAR(20) NOT NULL,
	 phone VARCHAR(15) NOT NULL,
	 PRIMARY KEY(doctor_id)
);

CREATE TABLE test(
	test_id INT,
	template_name VARCHAR(40) NOT NULL,
	PRIMARY KEY (test_id)
);


CREATE TABLE questions(
	question_id INT,
  	test_id INT,
	question VARCHAR(50) NOT NULL,
	PRIMARY KEY (question_id),
  	FOREIGN KEY (test_id) REFERENCES test(test_id)
);

CREATE TABLE test_instance(
	instance_id INT,
  	test_id INT,
	result_description VARCHAR(30) NOT NULL,
	result INT NOT NULL,
	PRIMARY KEY (instance_id),
  	FOREIGN KEY (test_id) REFERENCES test(test_id)
);

CREATE TABLE answer(
	answer_id INT,
	question_id INT,
	instance_id INT,
	answer_value INT NOT NULL,
	PRIMARY KEY (answer_id),
	FOREIGN KEY (instance_id) REFERENCES test_instance(instance_id),
	FOREIGN KEY (question_id) REFERENCES questions(question_id)
);

CREATE TABLE meds(
    med_id INT,
    med_name VARCHAR(15) NOT NULL,
    ingredient VARCHAR(15) NOT NULL,
  	dose VARCHAR(8) NOT NULL,
    PRIMARY KEY (med_id)
);

CREATE TABLE dsm5(
	dsm5_id INT,
	icd10 VARCHAR(7) NOT NULL,
  	idcd9 VARCHAR(9) NOT NULL,
	frquent_diagnostic BIT NOT NULL,
	PRIMARY KEY (dsm5_id)
);

CREATE TABLE consult(
 	consult_id INT,
	instance_id INT, --mandar referencia a tabla test_instance
	patient_id INT NOT NULL,
	doctor_id INT NOT NULL,
 	peea VARCHAR(100) NOT NULL,
	consult_schedule CHAR(5) NOT NULL,
	consult_date DATE,
	PRIMARY KEY(consult_id),
	FOREIGN KEY(patient_id) REFERENCES patient(patient_id),
	FOREIGN KEY(doctor_id) REFERENCES doctor(doctor_id),
	FOREIGN KEY(prescription_id) REFERENCES prescription(prescription_id),
	FOREIGN KEY(instance_id) REFERENCES test_instance(instance_id)
);

CREATE TABLE dsm5_consult( -- cambiar nombre de la tabla
	consult_id INT,
  	dsm5_id INT,
	PRIMARY KEY (consult_id, dsm5_id),
  	FOREIGN KEY (consult_id) REFERENCES consult(consult_id),
  	FOREIGN KEY (dsm5_id) REFERENCES dsm5(dsm5_id)
);
CREATE TABLE prescription_meds( -- cambiar nombre de la tabla
	med_id INT,
	consult_id INT,
	instructions VARCHAR(40),
	PRIMARY KEY (med_id, consult_id),
	FOREIGN KEY (med_id) REFERENCES meds(med_id),
	FOREIGN KEY (consult_id) REFERENCES prescription(consult_id)
);
COMMIT;


