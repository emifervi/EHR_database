/* Complex Query 1
	Get 
*/
DELIMITER $$
    CREATE PROCEDURE get_prescription_by_consult(IN consult_id_input INT)
    SELECT consult_schedule AS 'Time', consult_date AS 'Date', consult_id AS 'Visit id', medicine_name AS 'Medicine name', instructions 
    FROM consult JOIN prescription 
    ON consult.prescription_id = prescription.prescription_id 
    JOIN recipe ON prescription.prescription_id = recipe.prescription_id 
    JOIN medicine ON recipe.medicine_id= medicine.medicine_id
    WHERE consult_id_input = consult_id
$$ DELIMITER ;





/* Complex Query Emilio */
DELIMITER $$
    CREATE PROCEDURE count_patients_by_age()
    SELECT YEAR(CURRENT_TIMESTAMP)-YEAR(date_of_birth)-(RIGHT(CURRENT_TIMESTAMP, 5)<RIGHT(date_of_birth, 5)) as age, 
    COUNT(YEAR(CURRENT_TIMESTAMP) - YEAR(date_of_birth) - (RIGHT(CURRENT_TIMESTAMP, 5) < RIGHT(date_of_birth, 5)))
    FROM patient
    GROUP BY age
$$ DELIMITER ;

DELIMITER $$
    CREATE PROCEDURE count_patients_by_sex()
    SELECT sex, COUNT(sex)
    FROM patient
    GROUP BY sex
$$ DELIMITER ;